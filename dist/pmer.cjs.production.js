"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.PMER_MESSAGE_ID=0;var e="PMER_MESSAGE_IDENT";var r=false;try{window.postMessage({toString:function e(){r=true}},"*")}catch(e){}function t(e){return"PMER_REPLY::".concat(e)}function n(e){return/^PMER_REPLY::/.test(e)}function s(e){return e.window===e}function a(e,t,n,a){if(r){t=JSON.stringify(t)}if(s(e)){e.postMessage(t,n||"*",a)}else{e.postMessage(t,a)}}function i(e){var t=e.data;if(r){try{t=JSON.parse(e.data)}catch(e){}}e.parsedData=t;return e}function o(r,n,s,i,o){return new Promise(function(f,c){var d=exports.PMER_MESSAGE_ID++;var p;if(Array.isArray(i)){var _=[i];o=_[0];i=_[1]}a(r,{__ident__:e,id:d,type:n,message:s},i,o);u(t(n),function(e,r){clearTimeout(p);if(r.parsedData.error){c(new Error(e))}else{f(e)}},function(e){return e.parsedData.id===d})})}function f(r,s,o){function f(f){var u=i(f);var c=u.parsedData;if(typeof c==="object"){var d=c.id,p=c.type,_=c.message,E=c.__ident__;if(!Array.isArray(r)){r=[r]}if(E===e&&r.some(function(e){return e==="*"||e===p})&&(!o||o(u))){var v=s(_,u);var y=function r(n){var s=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;a(u.source,{__ident__:e,id:d,type:t(p),message:n,error:s},u.origin)};if(u.source&&!n(p)){if(typeof v==="object"&&typeof v.then==="function"){v.then(y,function(e){return y(e instanceof Error?e.message:e,true)})}else{y(v)}}}}}function u(){window.removeEventListener("message",f,false)}window.addEventListener("message",f,false);return u}function u(e,r,t){var n=f(e,function(){n();return r.apply(void 0,arguments)},t);return n}exports.PMER_IDENT=e;exports.addListener=f;exports.addListenerOnce=u;exports.postMessage=o;
