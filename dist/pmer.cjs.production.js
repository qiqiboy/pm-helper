"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.PMER_MESSAGE_ID=0;var e="PMER_MESSAGE_IDENT";var r=false;try{window.postMessage({toString:function e(){r=true}},"*")}catch(e){}function t(e){return"PMER_REPLY::".concat(e)}function n(e){return e.window===e}function i(e,t,i,o){if(r){t=JSON.stringify(t)}if(n(e)){e.postMessage(t,i||"*",o)}else{e.postMessage(t,o)}}function o(e){var t=e.data;if(r){try{t=JSON.parse(e.data)}catch(e){}}return t}function s(r,n,s,a,u){return new Promise(function(c,d){var p=exports.PMER_MESSAGE_ID++;var _;if(Array.isArray(a)){var E=[a];u=E[0];a=E[1]}i(r,{__ident__:e,id:p,type:n,message:s},a,u);f(t(n),function(e,r){clearTimeout(_);if(o(r).error){d(new Error(e))}else{c(e)}},function(e){return o(e).id===p})})}function a(r,n,s){function a(a){var f=o(a);if(typeof f==="object"){var u=f.id,c=f.type,d=f.message,p=f.__ident__;if(!Array.isArray(r)){r=[r]}if(p===e&&r.some(function(e){return e==="*"||e===c})&&(!s||s(a))){var _=n(d,a);var E=function r(n){var o=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;i(a.source,{__ident__:e,id:u,type:t(c),message:n,error:o},a.origin)};if(typeof _!=="undefined"&&a.source){if(typeof _==="object"&&typeof _.then==="function"){_.then(E,function(e){return E(e instanceof Error?e.message:e,true)})}else{E(_)}}}}}function f(){window.removeEventListener("message",a,false)}window.addEventListener("message",a,false);return f}function f(e,r,t){var n=a(e,function(){n();return r.apply(void 0,arguments)},t);return n}exports.PMER_IDENT=e;exports.addListener=a;exports.addListenerOnce=f;exports.postMessage=s;
