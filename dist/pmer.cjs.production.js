"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.PMER_MESSAGE_ID=0;var e="PMER_MESSAGE_IDENT";var r=false;try{window.postMessage({toString:function e(){r=true}},"*")}catch(e){}function t(e){return"PMER_REPLY::".concat(e)}function n(e){return/^PMER_REPLY::/.test(e)}function a(e){return e.window===e}function i(e,t,n){var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:[];if(r){t=JSON.stringify(t)}if(a(e)){e.postMessage(t,n||"*",i)}else{e.postMessage(t,i)}}function o(e){var t=e.data;if(r){try{t=JSON.parse(e.data)}catch(e){}}e.parsedData=t;return e}function s(r,n,a,o,s){return new Promise(function(f,c){var d=exports.PMER_MESSAGE_ID++;var p;if(Array.isArray(o)){var _=[o];s=_[0];o=_[1]}i(r,{__ident__:e,id:d,type:n,payload:a},o,s);u(t(n),function(e,r){clearTimeout(p);if(r.parsedData.error){c(new Error(e))}else{f(e)}},function(e){return e.parsedData.id===d})})}function f(r,a,s){function f(f){var u=o(f);var c=u.parsedData;if(typeof c==="object"){var d=c.id,p=c.type,_=c.payload,E=c.__ident__;if(!Array.isArray(r)){r=[r]}if(E===e&&r.some(function(e){return e==="*"||e===p})&&(!s||s(u))){var v=a(_,u);var y=function r(n){var a=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;i(u.source,{__ident__:e,id:d,type:t(p),payload:n,error:a},u.origin)};if(u.source&&!n(p)){if(v&&typeof v==="object"&&typeof v.then==="function"){v.then(y,function(e){return y(e instanceof Error?e.message:e,true)})}else{y(v)}}}}}function u(){window.removeEventListener("message",f,false)}window.addEventListener("message",f,false);return u}function u(e,r,t){var n=f(e,function(){n();return r.apply(void 0,arguments)},t);return n}exports.PMER_IDENT=e;exports.addListener=f;exports.addListenerOnce=u;exports.postMessage=s;
