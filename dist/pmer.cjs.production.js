"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.PMER_MESSAGE_ID=0;var e=new Error("PMER_POST_MESSAGE_TIMEOUT");var t="PMER_MESSAGE_IDENT";function n(e){return"PMER_REPLY::".concat(e)}function r(e){return e.window===window}function o(e,t,n,o){if(r(e)){e.postMessage(t,n||"*",o)}else{e.postMessage(t,o)}}window.addEventListener("unhandledrejection",function(t){if(t.reason===e){t.preventDefault()}});function i(r,i,s,u,f){return new Promise(function(d,_){var c=exports.PMER_MESSAGE_ID++;var E;if(Array.isArray(u)){var p=[u];f=p[0];u=p[1]}o(r,{__ident__:t,id:c,type:i,message:s},u,f);var v=a(n(i),function(e){clearTimeout(E);if(typeof e==="object"&&typeof e.then==="function"){e.then(d,_)}else{d(e)}},c);E=setTimeout(function(){v();_(e)},60*1e3)})}function s(e,r,i){function s(s){if(typeof s.data==="object"){var a=s.data,u=a.id,f=a.type,d=a.message,_=a.__ident__;if(!Array.isArray(e)){e=[e]}if(_===t&&e.some(function(e){return e==="*"||e===f})&&(!i||u===i)){var c=r(d,s);if(typeof c!=="undefined"&&s.source){o(s.source,{__ident__:t,id:i,type:n(f),message:c},s.origin)}}}}function a(){window.removeEventListener("message",s,false)}window.addEventListener("message",s,false);return a}function a(e,t,n){var r=s(e,function(){r();return t.apply(void 0,arguments)},n);return r}exports.PMER_IDENT=t;exports.PMER_UNHANDLE_REJECTION=e;exports.addListener=s;exports.addListenerOnce=a;exports.postMessage=i;
