"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.PMER_MESSAGE_ID=0;var e=new Error("PMER_POST_MESSAGE_TIMEOUT");var t="PMER_MESSAGE_IDENT";function n(e){return"PMER_REPLY::".concat(e)}function r(e){return e.window===e}function i(e,t,n,i){if(r(e)){e.postMessage(t,n||"*",i)}else{e.postMessage(t,i)}}window.addEventListener("unhandledrejection",function(t){if(t.reason===e){t.preventDefault()}});function o(r,o,s,u,f){return new Promise(function(d,c){var _=exports.PMER_MESSAGE_ID++;var E;if(Array.isArray(u)){var p=[u];f=p[0];u=p[1]}i(r,{__ident__:t,id:_,type:o,message:s},u,f);var v=a(n(o),function(e){clearTimeout(E);if(typeof e==="object"&&typeof e.then==="function"){e.then(d,c)}else{d(e)}},function(e){return e.data.id===_});E=setTimeout(function(){v();c(e)},60*1e3)})}function s(e,r,o){function s(s){if(typeof s.data==="object"){var a=s.data,u=a.id,f=a.type,d=a.message,c=a.__ident__;if(!Array.isArray(e)){e=[e]}if(c===t&&e.some(function(e){return e==="*"||e===f})&&(!o||o(s))){var _=r(d,s);if(typeof _!=="undefined"&&s.source){i(s.source,{__ident__:t,id:u,type:n(f),message:_},s.origin)}}}}function a(){window.removeEventListener("message",s,false)}window.addEventListener("message",s,false);return a}function a(e,t,n){var r=s(e,function(){r();return t.apply(void 0,arguments)},n);return r}exports.PMER_IDENT=t;exports.PMER_UNHANDLE_REJECTION=e;exports.addListener=s;exports.addListenerOnce=a;exports.postMessage=o;
