"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.mid=0;var e=new Error("PMER_POST_MESSAGE_TIMEOUT");var n="PMER_MESSAGE_IDENT";function t(e){return"PMER_REPLY::".concat(e)}window.addEventListener("unhandledrejection",function(n){if(n.reason===e){n.preventDefault()}});function r(r,i,s){var a=arguments.length>3&&arguments[3]!==undefined?arguments[3]:"*";var u=arguments.length>4?arguments[4]:undefined;return new Promise(function(d,f){var c=exports.mid++;var p;r.postMessage({__ident__:n,id:c,type:i,message:s},a,u);var _=o(t(i),function(e){clearTimeout(p);d(e)},c);p=setTimeout(function(){_();f(e)},60*1e3)})}function i(e,r,i){function o(o){if(typeof o.data==="object"){var s=o.data,a=s.id,u=s.type,d=s.message,f=s.__ident__;if(!Array.isArray(e)){e=[e]}if(f===n&&e.length&&e.some(function(e){return e==="*"||e===u})&&(!i||a===i)){var c=r(d,o);if(typeof c!=="undefined"&&o.source){var p=function e(r){o.source.postMessage({__ident__:n,id:i,type:t(u),message:r},o.origin)};if(typeof c==="object"&&typeof c.then==="function"){c.then(p)}else{p(c)}}}}}function s(){window.removeEventListener("message",o,false)}window.addEventListener("message",o,false);return s}function o(e,n,t){var r=i(e,function(){r();return n.apply(void 0,arguments)},t);return r}exports.addListener=i;exports.addListenerOnce=o;exports.postMessage=r;
