(function(e,n){typeof exports==="object"&&typeof module!=="undefined"?n(exports):typeof define==="function"&&define.amd?define(["exports"],n):(e=e||self,n(e.pmer={}))})(this,function(e){"use strict";e.PMER_MESSAGE_ID=0;var n="PMER_MESSAGE_IDENT";var t=false;try{window.postMessage({toString:function e(){t=true}},"*")}catch(e){}function r(e){return"PMER_REPLY::".concat(e)}function i(e){return/^PMER_REPLY::/.test(e)}function a(e){return e.window===e}function o(e,n,r){var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:[];if(t){n=JSON.stringify(n)}if(a(e)){e.postMessage(n,r||"*",i)}else{e.postMessage(n,i)}}function f(e){var n=e.data;if(t){try{n=JSON.parse(e.data)}catch(e){}}e.parsedData=n;return e}function s(t,i,a,f,s){return new Promise(function(u,c){var p=e.PMER_MESSAGE_ID++;var _;if(Array.isArray(f)){var y=[f];s=y[0];f=y[1]}o(t,{__ident__:n,id:p,type:i,payload:a},f,s);d(r(i),function(e,n){clearTimeout(_);if(n.parsedData.error){c(new Error(e))}else{u(e)}},function(e){return e.parsedData.id===p})})}function u(e,t,a){function s(s){var u=f(s);var d=u.parsedData;if(typeof d==="object"){var c=d.id,p=d.type,_=d.payload,y=d.__ident__;if(!Array.isArray(e)){e=[e]}if(y===n&&e.some(function(e){return e==="*"||e===p})&&(!a||a(u))){var E=t(_,u);var v=function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;o(u.source,{__ident__:n,id:c,type:r(p),payload:t,error:i},u.origin)};if(u.source&&!i(p)){if(typeof E==="object"&&typeof E.then==="function"){E.then(v,function(e){return v(e instanceof Error?e.message:e,true)})}else{v(E)}}}}}function u(){window.removeEventListener("message",s,false)}window.addEventListener("message",s,false);return u}function d(e,n,t){var r=u(e,function(){r();return n.apply(void 0,arguments)},t);return r}e.PMER_IDENT=n;e.addListener=u;e.addListenerOnce=d;e.postMessage=s;Object.defineProperty(e,"__esModule",{value:true})});
