var e=0;var n="PMER_MESSAGE_IDENT";var r=false;try{window.postMessage({toString:function e(){r=true}},"*")}catch(e){}function t(e){return"PMER_REPLY::".concat(e)}function i(e){return e.window===e}function o(e,n,t,o){if(r){n=JSON.stringify(n)}if(i(e)){e.postMessage(n,t||"*",o)}else{e.postMessage(n,o)}}function a(e){var n=e.data;if(r){try{n=JSON.parse(e.data)}catch(e){}}return n}function s(r,i,s,f,c){return new Promise(function(d,v){var _=e++;var y;if(Array.isArray(f)){var g=[f];c=g[0];f=g[1]}o(r,{__ident__:n,id:_,type:i,message:s},f,c);u(t(i),function(e,n){clearTimeout(y);if(a(n).error){v(new Error(e))}else{d(e)}},function(e){return a(e).id===_})})}function f(e,r,i){function s(s){var f=a(s);if(typeof f==="object"){var u=f.id,c=f.type,d=f.message,v=f.__ident__;if(!Array.isArray(e)){e=[e]}if(v===n&&e.some(function(e){return e==="*"||e===c})&&(!i||i(s))){var _=r(d,s);var y=function e(r){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;o(s.source,{__ident__:n,id:u,type:t(c),message:r,error:i},s.origin)};if(s.source){if(typeof _==="object"&&typeof _.then==="function"){_.then(y,function(e){return y(e instanceof Error?e.message:e,true)})}else{y(_)}}}}}function f(){window.removeEventListener("message",s,false)}window.addEventListener("message",s,false);return f}function u(e,n,r){var t=f(e,function(){t();return n.apply(void 0,arguments)},r);return t}export{n as PMER_IDENT,e as PMER_MESSAGE_ID,f as addListener,u as addListenerOnce,s as postMessage};
