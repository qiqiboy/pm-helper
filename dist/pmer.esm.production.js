var e=0;var n="PMER_MESSAGE_IDENT";var r=false;try{window.postMessage({toString:function e(){r=true}},"*")}catch(e){}function t(e){return"PMER_REPLY::".concat(e)}function i(e){return e.window===e}function o(e,n,t,o){if(r){n=JSON.stringify(n)}if(i(e)){e.postMessage(n,t||"*",o)}else{e.postMessage(n,o)}}function a(e){var n=e.data;if(r){try{n=JSON.parse(e.data)}catch(e){}}return n}function f(r,i,f,s,c){return new Promise(function(d,v){var y=e++;var _;if(Array.isArray(s)){var p=[s];c=p[0];s=p[1]}o(r,{__ident__:n,id:y,type:i,message:f},s,c);u(t(i),function(e,n){clearTimeout(_);if(a(n).error){v(new Error(e))}else{d(e)}},function(e){return a(e).id===y})})}function s(e,r,i){function f(f){var s=a(f);if(typeof s==="object"){var u=s.id,c=s.type,d=s.message,v=s.__ident__;if(!Array.isArray(e)){e=[e]}if(v===n&&e.some(function(e){return e==="*"||e===c})&&(!i||i(f))){var y=r(d,f);var _=function e(r){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;o(f.source,{__ident__:n,id:u,type:t(c),message:r,error:i},f.origin)};if(typeof y!=="undefined"&&f.source){if(typeof y==="object"&&typeof y.then==="function"){y.then(_,function(e){return _(e instanceof Error?e.message:e,true)})}else{_(y)}}}}}function s(){window.removeEventListener("message",f,false)}window.addEventListener("message",f,false);return s}function u(e,n,r){var t=s(e,function(){t();return n.apply(void 0,arguments)},r);return t}export{n as PMER_IDENT,e as PMER_MESSAGE_ID,s as addListener,u as addListenerOnce,f as postMessage};
