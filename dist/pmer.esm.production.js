var e=0;var r="PMER_MESSAGE_IDENT";var n=false;try{window.postMessage({toString:function e(){n=true}},"*")}catch(e){}function t(e){return"PMER_REPLY::".concat(e)}function a(e){return/^PMER_REPLY::/.test(e)}function i(e){return e.window===e}function o(e,r,t,a){if(n){r=JSON.stringify(r)}if(i(e)){e.postMessage(r,t||"*",a)}else{e.postMessage(r,a)}}function s(e){var r=e.data;if(n){try{r=JSON.parse(e.data)}catch(e){}}e.parsedData=r;return e}function f(n,a,i,s,f){return new Promise(function(u,d){var v=e++;var p;if(Array.isArray(s)){var _=[s];f=_[0];s=_[1]}o(n,{__ident__:r,id:v,type:a,message:i},s,f);c(t(a),function(e,r){clearTimeout(p);if(r.parsedData.error){d(new Error(e))}else{u(e)}},function(e){return e.parsedData.id===v})})}function u(e,n,i){function f(f){var u=s(f);var c=u.parsedData;if(typeof c==="object"){var d=c.id,v=c.type,p=c.message,_=c.__ident__;if(!Array.isArray(e)){e=[e]}if(_===r&&e.some(function(e){return e==="*"||e===v})&&(!i||i(u))){var y=n(p,u);var g=function e(n){var a=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;o(u.source,{__ident__:r,id:d,type:t(v),message:n,error:a},u.origin)};if(u.source&&!a(v)){if(typeof y==="object"&&typeof y.then==="function"){y.then(g,function(e){return g(e instanceof Error?e.message:e,true)})}else{g(y)}}}}}function u(){window.removeEventListener("message",f,false)}window.addEventListener("message",f,false);return u}function c(e,r,n){var t=u(e,function(){t();return r.apply(void 0,arguments)},n);return t}export{r as PMER_IDENT,e as PMER_MESSAGE_ID,u as addListener,c as addListenerOnce,f as postMessage};
