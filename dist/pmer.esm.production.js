var e=0;var r="PMER_MESSAGE_IDENT";var n=false;try{window.postMessage({toString:function e(){n=true}},"*")}catch(e){}function t(e){return"PMER_REPLY::".concat(e)}function a(e){return/^PMER_REPLY::/.test(e)}function i(e){return e.window===e}function o(e,r,t,a){if(n){r=JSON.stringify(r)}if(i(e)){e.postMessage(r,t||"*",a)}else{e.postMessage(r,a)}}function f(e){var r=e.data;if(n){try{r=JSON.parse(e.data)}catch(e){}}e.parsedData=r;return e}function s(n,a,i,f,s){return new Promise(function(u,d){var p=e++;var v;if(Array.isArray(f)){var y=[f];s=y[0];f=y[1]}o(n,{__ident__:r,id:p,type:a,payload:i},f,s);c(t(a),function(e,r){clearTimeout(v);if(r.parsedData.error){d(new Error(e))}else{u(e)}},function(e){return e.parsedData.id===p})})}function u(e,n,i){function s(s){var u=f(s);var c=u.parsedData;if(typeof c==="object"){var d=c.id,p=c.type,v=c.payload,y=c.__ident__;if(!Array.isArray(e)){e=[e]}if(y===r&&e.some(function(e){return e==="*"||e===p})&&(!i||i(u))){var _=n(v,u);var l=function e(n){var a=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;o(u.source,{__ident__:r,id:d,type:t(p),payload:n,error:a},u.origin)};if(u.source&&!a(p)){if(typeof _==="object"&&typeof _.then==="function"){_.then(l,function(e){return l(e instanceof Error?e.message:e,true)})}else{l(_)}}}}}function u(){window.removeEventListener("message",s,false)}window.addEventListener("message",s,false);return u}function c(e,r,n){var t=u(e,function(){t();return r.apply(void 0,arguments)},n);return t}export{r as PMER_IDENT,e as PMER_MESSAGE_ID,u as addListener,c as addListenerOnce,s as postMessage};
